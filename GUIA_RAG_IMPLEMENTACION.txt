=================================================================
  GU√çA DE IMPLEMENTACI√ìN - RAG CON EMBEDDINGS VECTORIALES
=================================================================

PASO 1: CONFIGURAR .ENV
-----------------------------------------------------------------
Agregar/verificar en tu archivo .env:

# Embeddings (Usando Gemini - GRATIS)
USE_VECTOR_SEARCH=false    # Cambiar a 'true' cuando est√© listo
EMBEDDING_MODEL=text-embedding-004
GEMINI_API_KEY=tu_gemini_api_key_aqui

# NOTA: Ya NO necesitas OPENAI_API_KEY para embeddings
# Gemini los genera GRATIS (60 requests/minuto)

# Obtener Gemini API key GRATIS en:
# https://makersuite.google.com/app/apikey


PASO 2: CREAR TABLA DE EMBEDDINGS
-----------------------------------------------------------------
Ejecutar el script SQL:

cd "D:\Tesis app sis\SportBack-funcionalBack"
mysql -u root -p sport < embedding_products.sql

Verificar que se cre√≥:
mysql -u root -p sport
> SHOW TABLES;
> DESCRIBE product_embeddings;


PASO 3: GENERAR EMBEDDINGS DE PRODUCTOS (Una sola vez)
-----------------------------------------------------------------
Ejecutar el script de generaci√≥n:

cd "D:\Tesis app sis\SportBack-funcionalBack"
node scripts/generateProductEmbeddings.js

Esto:
- Lee los 18 productos de la BD
- Genera embedding para cada uno (usa Gemini API - GRATIS)
- Guarda en la tabla product_embeddings
- Tiempo: ~10-15 segundos
- Costo: $0 USD - TOTALMENTE GRATIS con Gemini
- Dimensiones del vector: 768 (Gemini) vs 1536 (OpenAI)

Salida esperada:
  üöÄ Generando embeddings para 18 productos...
  ‚úÖ [1/18] GO Energy Isotonic Gel
  ‚úÖ [2/18] GO Energy + Caffeine Gel
  ...
  üéâ Proceso completado!
  ‚úÖ Exitosos: 18


PASO 4: PROBAR LA B√öSQUEDA VECTORIAL
-----------------------------------------------------------------
Ejecutar script de prueba:

node scripts/testVectorSearch.js

Salida esperada:
  üìä Embeddings en BD: 18
  üîÑ Generando embedding del perfil...
  ‚úÖ Embedding generado: Vector de 1536 dimensiones
  üîç Buscando productos similares...
  
  üîç Top 5 productos m√°s similares:
    1. GO Energy Gel - Similitud: 87.34%
    2. HYDRO Tablet - Similitud: 82.15%
    ...


PASO 5: ACTIVAR RAG EN PRODUCCI√ìN
-----------------------------------------------------------------
Cambiar en .env:

USE_VECTOR_SEARCH=true

Reiniciar servidor:
  npm run dev


PASO 6: VERIFICAR QUE FUNCIONA
-----------------------------------------------------------------
En la app m√≥vil:
1. Crear un entrenamiento (ej: Cardio, 45 min, Alto)
2. Ver logs del backend

Logs esperados:
  üîç Usando b√∫squeda vectorial (RAG)...
  ‚úÖ Vector search: 18 productos encontrados, 15 despu√©s de filtros
  üîç Top 5 productos m√°s similares:
    1. GO Energy Gel - Similitud: 89.23%
    ...


COMPARACI√ìN: SQL vs VECTOR SEARCH
-----------------------------------------------------------------

ANTES (SQL):
  SELECT * FROM products 
  WHERE ... 
  ORDER BY carbs_g DESC
  ‚Üí Ordena solo por carbohidratos

AHORA (Vector RAG):
  1. Genera vector del usuario: [0.82, 0.11, ...]
  2. Compara con vectores de productos
  3. Encuentra productos sem√°nticamente similares
  4. Aplica filtros duros (vegano, cafe√≠na)
  5. Devuelve top 20
  
  ‚Üí Entiende el CONTEXTO completo (objetivo + tipo + intensidad)


ARCHIVOS DEL SISTEMA RAG
-----------------------------------------------------------------
NUEVOS:
  ‚úÖ embedding_products.sql - Tabla de embeddings
  ‚úÖ services/embeddingServices.js - Generaci√≥n de vectores
  ‚úÖ services/vectorSearchService.js - B√∫squeda por similitud
  ‚úÖ scripts/generateProductEmbeddings.js - Generar embeddings
  ‚úÖ scripts/testVectorSearch.js - Prueba del sistema

MODIFICADOS:
  ‚úÖ services/retrievalService.js - Soporta vector search
  ‚úÖ services/trainingRecommendationService.js - Usa nuevo retrieval
  ‚úÖ controllers/recommendationController.js - Pasa training data


COSTOS CON GEMINI
-----------------------------------------------------------------
‚úÖ TOTALMENTE GRATIS

Gemini API - L√≠mites gratuitos:
  - 60 requests por minuto
  - 1,500 requests por d√≠a
  - Sin costo
  
Para tu caso (18 productos):
  - Generaci√≥n inicial: 18 requests
  - Por recomendaci√≥n: 1 request
  - Costo: $0 USD
  
¬°100% GRATIS con Gemini!


TROUBLESHOOTING
-----------------------------------------------------------------

Error: "OpenAI API key is missing"
  ‚Üí Verificar OPENAI_API_KEY en .env

Error: "No product embeddings found"
  ‚Üí Ejecutar: node scripts/generateProductEmbeddings.js

Error: "Invalid vectors for similarity"
  ‚Üí Verificar que los embeddings se guardaron correctamente en BD
  ‚Üí SELECT * FROM product_embeddings LIMIT 1;

Error: Rate limit OpenAI
  ‚Üí Aumentar delay en generateProductEmbeddings.js (l√≠nea 58)
  ‚Üí await new Promise(resolve => setTimeout(resolve, 1000));


VENTAJAS DEL NUEVO SISTEMA
-----------------------------------------------------------------
‚úÖ B√∫squeda sem√°ntica (entiende conceptos)
‚úÖ Mejor contexto (considera todo el perfil)
‚úÖ M√°s flexible (no solo reglas SQL)
‚úÖ Mejores recomendaciones
‚úÖ Fallback a SQL si falla
‚úÖ Activaci√≥n con flag (USE_VECTOR_SEARCH)


DESACTIVAR RAG (Volver a SQL)
-----------------------------------------------------------------
En .env:
  USE_VECTOR_SEARCH=false

Reiniciar servidor.


FIN DE LA GU√çA
=================================================================

